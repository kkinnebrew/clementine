/**
 * OrangeUI | 0.5.0 | 09.03.2012
 * https://github.com/brew20k/orangeui
 * Copyright (c) 2012 Kevin Kinnebrew
 */
function noop(){}function clone(a){var b,c=a instanceof Array?[]:{};for(b in a){if(b==="clone")continue;a[b]&&typeof a[b]=="object"?c[b]=clone(a[b]):c[b]=a[b]}return c}function proxy(a,b){var c=b;return function(){return a.apply(c,arguments)}}(function(){function k(){var a=arguments,b=a[0],c=typeof a[1]=="function"?a[1]:null,d=a[2];h.Loader.addModule(b,c,d)}function l(){var a=Array.prototype.slice.call(arguments),b=a[a.length-1],c=clone(a).splice(0,a.length-1);if(typeof c[0]!="function")for(var d=0,e=c.length;d<e;d++)h.Loader.loadModule(c[d]);b.call(window,h)}function m(a){if(typeof h.modules[a]!==undefined)return h.modules[a];throw"Could not require module"}var a,b,c,d,e,f,g,h={},i=/[^A-Za-z:0-9_\[\]]/g,j=/[^A-Za-z\-_]/g;b=function(){function c(){}var a=!1,b=/\b_super\b/;return c.extend=function(d){function h(){!a&&this.initialize&&this.initialize.apply(this,arguments)}var e,f,g=this.prototype;a=!0,e=new this,a=!1;for(f in d)e[f]=typeof d[f]=="function"&&typeof g[f]=="function"&&b.test(d[f])?function(a,b){return function(){var c=this._super;this._super=g[a];var d=b.apply(this,arguments);return this._super=c,d}}(f,d[f]):d[f];return h.prototype=e,h.prototype.constructor=h,h.extend=c.extend,h.include=c.include,h},c.include=function(a){var b,c,d;if(!a)throw"Missing definition";for(b in a)c=a[b],Array.prototype.indexOf.call(["extend","mixin"],b)<0&&(this.prototype[b]=c);return this},c}(),d=function(){function a(a,b,c,d){this.bubbles=!0,this.currentTarget=b,this.data=d,this.target=c,this.type=a}return a.prototype.stopPropagation=function(){this.bubbles=!1},a}(),e=function(){function a(a,b,c){this.call=c,this.ev=b,this.target=a}return a.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call},a}(),c={on:function(a,b,c){var d=typeof c!="undefined"?proxy(b,c):b;return this._listeners||(this._listeners={}),this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]),this._listeners[a].push(d),new e(this,a,d)},once:function(a,b,c){var d=typeof c!="undefined"?proxy(b,c):b,e=function(){b.apply(this,arguments),this.detach(a,d)};this.on(a,e)},fire:function(a,b){var c=this._parent||null,e=a;typeof a=="string"&&(a=new d(a,this,this,b));if(typeof a.type!="string")throw"Error: Invalid 'type' when firing event";this._listeners||(this._listeners={});if(this._listeners[a.type]instanceof Array){var f=this._listeners[a.type];for(var g=0,h=f.length;g<h;g++)f[g].call(this,a,b)}c!=null&&a.bubbles&&e[0]!=="_"&&(a.currentTarget=this._parent,c.fire.call(c,a,b))},detach:function(a,b){var c=[];this._listeners||(this._listeners={});if(typeof a=="undefined")this._listeners={};else if(this._listeners[a]instanceof Array)if(typeof b!="undefined"){c=this._listeners[a];for(var d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}}else this._listeners[a]=[]}},f=function(){var a={},b={},c={};return h.modules={},{addModule:function(b,c,d){if(!b.match(/[\^\-A-Za-z_]/g))throw"Invalid module name";var e={name:b,fn:c,req:d!==undefined?d:[]};a[b]=e},loadModule:function(d){if(b.hasOwnProperty(d))return;if(a[d]!==undefined){b[d]=!0;for(var e=0,f=a[d].req.length;e<f;e++){if(a[d].req[e]===d)continue;this.loadModule(a[d].req[e])}a[d].fn.call(window,c),h.modules[d]=c}}}}(),g=function(){function b(b,c,d){this.level>b&&(this.fire("msg",{message:c,ex:d}),d?console.log("["+a[b]+"]",c,d):console.log("["+a[b]+"]",c))}function d(){this.level=1}var a=["OFF","ERROR","WARN","INFO","DEBUG"];for(var e in c)d[e]=c[e];return d.prototype.setLevel=function(b){if(b in a)switch(b){case"DEBUG":b=4;break;case"INFO":b=3;break;case"WARN":b=2;break;case"ERROR":b=1;break;default:b=0}},d.prototype.debug=function(a,c){b.call(this,4,a,c)},d.prototype.info=function(a,c){b.call(this,3,a,c)},d.prototype.warn=function(a,c){b.call(this,2,a,c)},d.prototype.error=function(a,c){b.call(this,1,a,c)},d}(),a={touch:"ontouchstart"in window||window.hasOwnProperty("DocumentTouch")&&document instanceof DocumentTouch,location:"geolocation"in navigator},h=this.Orange={modules:{}},h.version="0.5.0",h.add=k,h.use=l,h.include=this.include=m,h.Browser=a=a,h.Class=this.Class=b,h.Events=this.Events=c,h.EventHandle=e,h.Loader=f,h.Log=this.Log=new g}).call(this),Array.prototype.clone=function(){return this.slice(0)},Array.prototype.indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},function(a){function h(){c!==null&&(clearTimeout(c),c=null)}function i(a){var g=Math.floor(Math.random()*1e4);if(navigator.onLine&&!f){e=!0,f=!0,b.fire("online",!0),a&&a(!0),d&&setTimeout(i,1e4);return}h(),c=setTimeout(function(){navigator.onLine&&!f?(e=!0,f=!0,b.fire("online",!0)):navigator.onLine?$.ajax({url:"ping.js?q="+g,type:"GET",success:function(){e===!1&&(e=!0,b.fire("online",!0))},error:function(){e===!0&&(e=!1,b.fire("online",!1))}}):setTimeout(function(){e===!0&&(e=!1,b.fire("online",!1))},100),c=null,d&&setTimeout(i,1e4)},f?100:0)}function j(){window.applicationCache.swapCache(),Log.debug("Cache updated and ready"),window.location.reload(!0)}var b={},c=null,d=!1,e=!1,f=!1,g=!1;for(var k in Events)b[k]=Events[k];b.init=function(a,c){if(g)return;d=!0,g=!0,$(window).bind("offline",i),$(window).bind("online",i),$(window).bind("updateready",j),i.call(b,proxy(a,c))},b.updateNetworkStatus=function(a){i.call(b)},b.isActive=function(){return g},b.isOnline=function(){return e},a.Cache=b}(Orange),function(a){var b;b=Class.extend({initialize:function(a,b){this.model=a,this.data=b,this.active=b,this.list=this.toArray(),this.events=[],this.events.push(this.model.on("datachange",Class.proxy(this.mergeDeltas,this))),this.events.push(this.model.on("datasync",Class.proxy(this.syncDeltas,this)))},mergeDeltas:function(a){var b=a.data;b.action==="set"?(this.data[b.id]=b.item,this.active.hasOwnProperty(b.id)&&(this.active[b.id]=b.item)):b.action==="delete"&&(this.data.hasOwnProperty(b.id)&&delete this.data[b.id],this.active.hasOwnProperty(b.id)&&delete this.active[b.id]),this.list=this.toArray()},syncDeltas:function(a){var b=a.data;if(this.data.hasOwnProperty(b.oldId)){var c=this.data["c"+b.oldId];delete this.data["c"+b.oldId],this.data[b.id]=c,this.data[b.id][this.model.getKey()]=b.id,this.data[b.id]._unsaved&&delete this.data[b.id]._unsaved,this.active.hasOwnProperty(b.oldId)&&(delete this.active[b.oldId],this.active[b.id]=c),this.list=this.toArray()}},count:function(){return this.list.length},get:function(a){return this.data.hasOwnProperty(a)?new this.model(this.data[a]):null},filter:function(a){if(typeof a=="function"&&this.active!==undefined)for(var b in this.active)a.call(this,this.active[b]||{})||delete this.active[b]},clearFilters:function(){this.active=this.data},toArray:function(){var a=[];for(var b in this.active)a.push(this.active[b]);return a},toObject:function(){return this.active},getModel:function(){return this.model},destroy:function(){for(var a=0,b=this.events.length;a<b;a++)this.events[a].detach();this.events=[]}}).include(Events),a.Collection=b}(Orange),function(a){var b,c=a.Model;b=Class.extend({initialize:function(a){var b=this,d,e;this.target=a,this.fields={},this.target.find("input, select, textarea, checkbox").not('input[type="submit"]').not('input[type="button"]').each(function(){var a=$(this).attr("name");a&&(b.fields[a]=$(this))}),d=this.target.attr("data-model"),d&&(e=c.load(d),e&&this.build(e)),this.target.submit(proxy(this.$onSubmit,this))},get:function(a){if(this.fields.hasOwnProperty(a))return this.fields[a].val()},set:function(a,b){this.fields.hasOwnProperty(a)&&this.fields[a].val(b)},clear:function(a){this.fields.hasOwnProperty(a)&&this.fields[a].val("")},disable:function(){for(var a in this.fields)this.fields[a].attr("disabled","disabled")},enable:function(){for(var a in this.fields)this.fields[a].removeAttr("disabled")},build:function(a){var b=a.getSchema()},getData:function(){var a={};for(var b in this.fields)a[b]=this.fields[b].val();return a},setData:function(a){for(var b in this.fields)a.hasOwnProperty(b)&&this.fields[b].val(a[b])},$onSubmit:function(a){var b=this.target.attr("action");if(typeof b!="undefined")return;a.preventDefault(),this.fire("submit",this.getData())},destroy:function(){for(var a in this.fields)delete this.fields[a]}}).include(Events),a.Form=b}(Orange),function(a){function g(){return(new Date).getTime()-e>f}function h(a,b){e=(new Date).getTime(),d=b.coords,typeof a=="function"&&a(b.coords)}function i(a){switch(a.code){case a.TIMEOUT:Log.warn("Location services timeout");break;case a.POSITION_UNAVAILABLE:Log.warn("Position unavailable");break;case a.PERMISSION_DENIED:Log.warn("Please Enable Location Services");break;default:Log.info("Unknown location services error")}}var b={},c=a.Browser,d=null,e=null,f=36e5;b.get=function(a,b){if(!c.location){b.call(this);return}if(typeof a!="function")return;if(d&&!g())return a(d);var e=function(a){i(a),b&&b.call(this)},f=function(b){h(a,b)};navigator.geolocation.getCurrentPosition(f,e)},a.Location=b}(Orange),function(a){var b,c=a.Collection,d=a.Events;b=Class.extend({initialize:function(a){var b=this.getKey();this.id=(a||{}).hasOwnProperty(b)?a[b]:null,this.data={},this.fields=this.getFields(),this.hasChanges=!1;var c=this.getFields();for(var d in c)a.hasOwnProperty("field")&&(this.data[d]=a[d])},getName:function(){throw"Cannot instantiate model"},getKey:function(){var a=this.getFields();for(var c in a)if(a[c].type===b.Field.KEY)return c},getFields:function(){throw"Cannot instantiate model"},get:function(a){if(!this.fields.hasOwnProperty(name))throw"Field does not exist";return this.data[name]},set:function(a,b){if(!this.fields.hasOwnProperty(name))throw"Field does not exist";this.data[name]=b,this.hasChanges=!0},clear:function(a){if(!this.fields.hasOwnProperty(name))throw"Field does not exist";delete this.data[name],this.hasChanges=!0},getId:function(){return this.id},getModel:function(){return this.constructor},toObject:function(){return this.data},destroy:function(){delete this.id,delete this.data,delete this.fields,delete this.hasChanges}}).include(d),b.get=function(a){if(b.models.hasOwnProperty(a))return b.models[a];throw'No model exists with name "'+a+'"'},b.extend=function(a){var c=Class.extend.call(this,a),d=["getName","getFields"];for(var e=0;e<d.length;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";c[d[e]]=a[d[e]]}b.models[c.getName()]=c},b.Field={KEY:1,TEXT:2,URL:3,ASSET:4,OBJECT:5,ARRAY:6,MAP:7,MODEL:8},b.Asset={IMAGE:1},a.Model=b}(Orange),function(a){var b,c=a.Model,d=a.Storage;b=Class.extend({initialize:function(a){if(a.hasOwnProperty("baseUrl"))a.baseUrl[a.baseUrl.length-1]==="/"?this.baseUrl=a.baseUrl.substr(0,a.baseUrl.length-1):this.baseUrl=a.baseUrl;else throw"Cannot instantiate service"},getName:function(){throw"Cannot instantiate service"},getPath:function(){throw"Cannot instantiate service"},mapStatus:function(a){return a},mapError:function(a){return a},mapErrorMessage:function(a){return a},mapResponse:function(a){return a},goOnline:function(){this.isOnline=!0},goOffline:function(){this.isOnline=!1},request:function(a,b,c,d,e,f){function h(a){var b;switch(a){case"parse":b="Error parsing response";break;case"offline":b="Service offline";break;default:b="Service error"}f(b)}function j(c){try{c=d.callback(c),d.from==="array"&&d.to==="collection"?c=this.parseArrayToCollection(c,d.map):d.from==="object"&&d.to==="collection"?c=this.parseObjectToCollection(c,d.map):d.from==="object"&&d.to==="model"&&(c=this.parseObjectToModel(c,d.map)),d.cache&&this.cacheResponse(a,b,c),e(c)}catch(f){h("parse")}}var g=this.baseUrl+a;if(!(b in["GET","POST","PUT","DELETE"]))throw"Invalid method type";if(!this.validateConf(d))throw"Invalid configuration";if(!this.isOnline){if(d.offline&&b==="GET"){var i=this.retrieveResponse(a,b,c);if(i){e(i);return}}h("offline");return}$.ajax({url:g,type:b,data:c,success:j,error:h})},validateConf:function(a){var b=["map","from","to","offline","cache","callback"];for(var c=0;c<b.length;c++){if(!a.hasOwnProperty(b[c]))return!1;if(b[c]==="map"&&!this.validateMap(a[b[c]]))return!1}},validateMap:function(a){var b=!0;return a.hasOwnProperty("model")?c.get(a.model)||(b=!1):b=!1,a.hasOwnProperty("params")||(b=!1),b},parseObjectToModel:function(a,b){var d={},e,f;for(var g in b.params)a.hasOwnProperty(b.params[g])&&(d[g]=a[b.params[g]]);return e=c.get(b.model),f=new e(d),f||!1},parseArrayToCollection:function(a,b){var c=[],d;if(typeof a!="Array")return!1;for(var e=0;e<a.length;e++)d=this.parseObjectToModel(a,b),d&&c.push(d);return c},parseObjectToCollection:function(a,b){var c=[];for(var d in a)c.push(a);this.parseArrayToCollection(c,b)},cacheResponse:function(a,b,e){var f;if(e instanceof Array){f=[];for(var g=0;g<e.length;g++)e[g]instanceof c?f.push({model:e[g].getModel().getType(),id:e[g].getId()}):f.push(e[g])}else e instanceof c?f={model:e.getModel().getType(),id:e.getId()}:f=e;var h=this.getName()+":"+b+":"+a;return d.set(h,f)},retrieveResponse:function(a,b){var c=this.getName()+":"+b+":"+a,e=d.get(c);return e||null}}),b.get=function(a){b.hasOwnProperty("services")||(b.services={});if(b.services.hasOwnProperty(a))return b.services[a]},b.extend=function(a){var c=Class.extend.call(this,a),d=["getName","getPath","getAuth"];for(var e=0;e<d.length;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";c[d[e]]=a[d[e]]}b.services[c.getName()]=c},a.Service=b}(Orange),function(a){var b={},c=window.localStorage,d=!1,e=!1;if("localStorage"in window)try{window.localStorage.setItem("_test",1),d=!0,window.localStorage.removeItem("_test")}catch(f){}if(d)try{window.localStorage&&(c=window.localStorage)}catch(f){}else if("globalStorage"in window)try{window.globalStorage&&(c=window.globalStorage[window.location.hostname],d=!0)}catch(f){}!JSON&&!JSON.hasOwnProperty("stringify")&&(d=!1),d||Log.warn("No native JSON parser found"),b.get=function(a){if(!d)return;try{var b=JSON.parse(c.getItem(a));if(b!==undefined&&b.data!==undefined)return e&&b.ttl!==-1&&(new Date).getTime()-b.timestamp>b.ttl&&c.removeItem(a),b.data}catch(f){Log.error("Error fetching object from localStorage")}},b.set=function(a,b,e){if(!d||typeof b=="undefined"||!a.match(/[^A-Za-z:0-9_\[\]]/g))return!1;var f={data:b,timestamp:(new Date).getTime(),ttl:e?e:864e5};try{return c.setItem(a,JSON.stringify(f)),!0}catch(g){g===QUOTA_EXCEEDED_ERR&&Log.error("Storage quota has been exceeded",g)}return!1},b.remove=function(a){if(!d)return!1;c.removeItem(a)},b.flushExpired=function(a){if(!d||e===!1&&a!==!0)return;for(var f in c)b.get(f)},b.flush=function(a){if(!d||e===!1&&a!==!0)return;c.clear(),Log.info("Clear: Local storage cleared")},b.isSupported=function(){return d},b.goOnline=function(){e=!0},b.goOffline=function(){e=!1},a.Storage=b}(Orange),function(a){function d(a,b,c){return $.ajax({async:c!==!0,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(c){b(a,c)},error:function(){throw"Error: template not found"}}).responseText}var b={},c={};b.get=function(a,b,d){var e=this,f=[],g;if(!c.hasOwnProperty(a))throw"Path "+a+" has not been loaded";$("<div>"+c[a]+"</div>").children().each(function(){f.push($(this))});for(var h=0;h<f.length;h++){if(typeof b!="undefined"&&f[h].attr("data-control")!==b)continue;if(typeof d!="undefined"&&f[h].attr("data-name")!==d)continue;return f[h]}throw"Could not find view "+b+" at "+a},b.register=function(a,b){function g(a,d){c[a]=d,f--,f===0&&b()}var e,f=a.length;if(f===0)return b();for(var h=0;h<a.length;h++)e=a[h],d(a[h],proxy(g,this))},a.View=b}(Orange),function(a){var b,c=a.Collection,d=a.Model;b=Class.extend({initialize:function(a){this.target=a,this.template=a.clone(),this.loaded=!1},bind:function(a,b){this.loaded&&this.unbind();if(a instanceof c)this.bindList(this.target,a.toArray(),a.getModel().getId());else if(a instanceof Array)this.bindList(this.target,a);else if(a instanceof d)this.bindModel(this.target,a.toObject(),a.getModel().getId());else if(typeof a=="object")this.bindData(this.target,a);else return;this.loaded=!0,typeof b=="function"&&b.call(this)},bindList:function(a,b,c){var d,e,f=a.find("[itemscope]:first"),g=a.clone().empty();if(!f.length){a.remove();return}f.remove(),e=f.clone();if(b instanceof Array)for(var h=0;h<b.length;h++)d=e.clone(),g.append(d),c?this.bindModel(d,b[c],c):this.bindData(d,b[h]);a.replaceWith(g)},bindModel:function(a,b,c){this.target.attr("itemid",b[c]),this.target.attr("itemscope"),this.bindData(b)},bindData:function(a,b){function f(b){var c=[];return a.find(b).each(function(){var b=!1,d=$(this).parent();while(d.length!==0&&!b){if($(d).not(a).length===0){b=!0;break}if($(d).not("[data-control]").length===0){b=!1;break}d=$(d).parent()}b&&c.push($(this))}),c}var c=[],d,e;if(typeof b=="string"&&a.has("[itemscope]")){a.text(b);return}c=f.call(this,"[itemprop]");for(var g=0;g<c.length;g++)d=c[g],e=d.attr("itemprop"),b.hasOwnProperty(e)?b[e]instanceof Array?this.bindList(d,b[e]):typeof b[e]=="object"?this.bindData(d,b[e]):typeof b[e]=="string"&&d.text(b[e]):d.remove()},unbind:function(){this.target.replaceWith(this.template.clone())},destroy:function(){delete this.target,delete this.template,delete this.loaded}}),a.Binding=b}(Orange),function(a){function g(a,b){b=$(b).eq(0),a=$(a)[0];for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];b.attr(d.name,d.value)}}var b,c=a.Binding,d=a.Browser,e=a.Form,f=a.View;b=Class.extend({initialize:function(a,c,d){var h=this,i=[],j=[],k=[];this.app=d,this.views={},this.forms={},this.elements={},this.data={},this.source=c.clone(),this.state="",this.loading=!1,this.unloading=!1,this.loaded=!1,this.visible=!1,this.appearing=!1,this.disappearing=!1,this.loadEvts=[],this.unloadEvts=[],this.showEvts=[],this.hideEvts=[],this.queue=[],this.running=!1,this.bindings={};var l;if(typeof c!="undefined")this.target=$(c),l=$(c).get(0);else throw"Invalid target";this._parent=typeof a!="undefined"?a:null,this._parent===null&&this.target.removeAttr("data-root");for(var m=0,n=l.attributes.length;m<n;m++)l.attributes[m].name.match(/data-/)&&(this.data[l.attributes[m].name.replace(/data-/,"")]=l.attributes[m].value);var o=function(a){var b=[];return this.target.find(a).each(function(){var a=!1,c=$(this).parent();while(c.length!==0&&!a){if($(c).not($(h.target)).length===0){a=!0;break}if($(c).not("[data-control]").length===0){a=!1;break}c=$(c).parent()}a&&b.push(this)}),b};i=o.call(this,"[data-control]"),j=o.call(this,"form"),k=o.call(this,"[data-name]:not([data-control])"),console.log(this.data.name+" "+"Initialized");for(m=0,n=i.length;m<n;m++){var p=$(i[m]),q=p.attr("data-name"),r=p.attr("data-control"),s=p.attr("data-template"),t=typeof s!="undefined"&&s.length>0;q||(q=p.attr("data-control"));if(t){var u=f.get(s,r,q);p.html($(u).html()),g(u,p),p.removeAttr("data-template")}var v=b.get(r);this.views[q]=new v(this,p,d)}for(m=0,n=j.length;m<n;m++){var w=$(j[m]),x=w.attr("name"),y=new e(w);this.forms[x]=y}for(m=0,n=k.length;m<n;m++){var z=$(k[m]),A=z.attr("data-name");typeof A!="undefined"&&A.length>0&&(this.elements[A]=z.removeAttr("data-name").addClass(A))}this.type=this.getType(),this.data.name=this.data.name||this.data.control,this.data.state&&(this.state=this.data.state),this.target.addClass(this.getClasses()),this.target.removeAttr("data-control").removeAttr("data-name").removeAttr("data-state")},add:function(a,b,c){this.queue.push({fn:a,args:b,wait:c}),this.running||this.next()},next:function(){this.running=!0;var a=this.queue.shift();a?(a.fn.apply(this,a.args),a.fn===this._setState&&setTimeout(proxy(function(){this.next()},this),a.wait)):this.running=!1},getType:function(){return"view"},getClasses:function(){var a=typeof this.typeList!="undefined"?this.typeList:"";return a+" "+this.data.name?this.data.name:""},getBindings:function(){return{}},getRoutes:function(){return{}},setRoute:function(a,b){var c=this.getRoutes(),d=a.clone(),e=d.shift();if(c.hasOwnProperty(e)){var f=c[e];for(var g in f){var h=f[g];b&&(h=[h.pop()]);for(var i=0;i<h.length;i++){var j=h[i];if(typeof j=="object"){var k=Object.keys(j).pop();this.getView(g).setState(k,j[k])}else typeof j=="string"&&this.getView(g).setState(j)}d.length>0&&this.getView(g).setRoute(d,b)}}},getState:function(){return this.state},setState:function(a,b){return this.add(this._setState,[a],b||0),this},_setState:function(a,b){if((this.hasState(a)||!this.loaded)&&!b)return;a&&console.log(this.data.name+" state is "+a),this.target.removeClass(this.state),this.target.addClass(a),this.state=a},hasState:function(a){return this.state===a},load:function(){return this.add(this._load),this},show:function(){return this.add(this._show),this},hide:function(){return this.add(this._hide),this},unload:function(){return this.add(this._unload),this},_load:function(){if(this.loading||this.loaded){this.next();return}this.loading=!0,this._setState(this.state,!0),this.loadEvts.push(this.on("_load",this.onLoad,this)),this.loadEvts.push(this.on("_loaded",this.onDidLoad,this)),this.onWillLoad()},_show:function(){if(this.visible||this.appearing||!this.loaded){this.next();return}this.appearing=!0,this.showEvts.push(this.on("_appear",this.onAppear,this)),this.showEvts.push(this.on("_appeared",this.onDidAppear,this)),this.onWillAppear()},_hide:function(){if(!this.visible||this.disappearing){this.next();return}this.disappearing=!0,this.hideEvts.push(this.on("_disappear",this.onDisappear,this)),this.hideEvts.push(this.on("_disappeared",this.onDidDisappear,this)),this.onWillDisappear()},_unload:function(){if(this.unloading||!this.loaded){this.next();return}if(this.visible&&!this.disappearing){this.hide().unload();return}this.unloadEvts.push(this.on("_unload",this.onUnload,this)),this.unloadEvts.push(this.on("_unloaded",this.onDidUnload,this)),this.unloading=!0,this.onWillUnload()},onWillLoad:function(){console.log(this.data.name+" "+"Will Load"),this.fire("_load")},onLoad:function(){var a=Object.keys(this.views).length;if(a===0)this.fire("_loaded");else for(var b in this.views){var c=this.views[b];c.once("load",proxy(function(){a--,a===0&&this.fire("_loaded")},this)),c.load()}},onDidLoad:function(){for(var a=0,b=this.loadEvts.length;a<b;a++)this.loadEvts[a].detach();console.log(this.data.name+" "+"Did Load"),this.loadEvts=[],this.loading=!1,this.loaded=!0,this.fire("load"),this.next()},onWillUnload:function(){console.log(this.data.name+" "+"Will Unload"),this.fire("_unload")},onUnload:function(){var a=Object.keys(this.views).length;if(a===0)this.target.remove(),this.fire("_unloaded");else for(var b in this.views){var c=this.views[b];c.once("unload",proxy(function(){a--,a===0&&(this.target.remove(),this.fire("_unloaded"))},this)),c.unload()}},onDidUnload:function(){console.log(this.data.name+" "+"Did Unload");for(var a=0,b=this.unloadEvts.length;a<b;a++)this.unloadEvts[a].detach();this.unloadEvts=[],this.unloading=!1,this.loaded=!1,this.fire("unload"),this.next()},onWillAppear:function(){console.log(this.data.name+" "+"Will Appear");var a=this.getBindings();for(var b in a){var c=a[b];for(var e in c){var f=null;typeof c[e]=="function"?f=c[e]:this.hasOwnProperty(c[e])&&(f=this[c[e]]),e==="touchclick"&&(e=d.touch?"touchend":"click");if(f===null){var g=e.charAt(0).toUpperCase()+e.slice(1);f=c[e]===!0&&typeof this["on"+g]=="function"?this["on"+g]:null}b==="$target"?this.target.on(e,$.proxy(f,this)):f!==null&&this.views.hasOwnProperty(b)?this.getView(b).on(e,$.proxy(f,this)):f!==null&&this.forms.hasOwnProperty(b)?this.getForm(b).on(e,$.proxy(f,this)):f!==null&&this.elements.hasOwnProperty(b)&&this.getElement(b).on(e,$.proxy(f,this))}}this.fire("_appear")},onAppear:function(a){var b=Object.keys(this.views).length;if(b===0)this.fire("_appeared");else for(var c in this.views){var d=this.views[c];d.once("appear",proxy(function(){b--,b===0&&this.fire("_appeared")},this)),d.show()}},onDidAppear:function(a){console.log(this.data.name+" "+"Did Appear");for(var b=0,c=this.showEvts.length;b<c;b++)this.showEvts[b].detach();this.showEvts=[],this.appearing=!1,this.visible=!0,this.fire("appear"),this.next()},onWillDisappear:function(){console.log(this.data.name+" "+"Will Disappear");for(var a in this.views)this.getView(a).detach();for(var b in this.forms)this.getForm(b).detach();for(var c in this.elements)this.getElement(c).unbind();this.fire("_disappear")},onDisappear:function(a){var b=Object.keys(this.views).length;if(b===0)this.fire("_disappeared");else for(var c in this.views){var d=this.views[c];d.once("disappear",proxy(function(){b--,b===0&&this.fire("_disappeared")},this)),d.hide()}},onDidDisappear:function(a){console.log(this.data.name+" "+"Did Disappear");for(var b=0,c=this.hideEvts.length;b<c;b++)this.hideEvts[b].detach();this.hideEvts=[],this.disappearing=!1,this.visible=!1,this.fire("disappear"),this.next()},getViews:function(){return this.views},getView:function(a){if(a instanceof b)return a;if(typeof this.views[a]!="undefined")return this.views[a];throw'Error: View "'+a+'" not found'},getForm:function(a){if(this.forms[a]instanceof e)return this.forms[a];throw'Error: Form "'+a+'" not found'},getElement:function(a){if(typeof this.elements[a]!="undefined")return this.elements[a];throw'Error: Element "'+a+'" not found'},addView:function(a,c,d){var e=b.get(a),g=f.get(d,a,c);return e&&(this.views[c]=new e(this,g,this.app)),this.views[c]},removeView:function(a){this.hasView(a)&&(this.views[a].hide().unload().destroy(),delete this.views[a])},hasView:function(a){return typeof this.views[a]!="undefined"},hasForm:function(a){return typeof this.forms[a]!="undefined"},hasElement:function(a){return typeof this.elements[a]!="undefined"},bind:function(a,b){if(!this.hasElement(a))return;this.bindings.hasOwnProperty(a)&&(this.bindings[a].unbind(),delete this.bindings[a]),this.bindings[a]=new c(this.getElement(a)),this.bindings[a].bind(b)},unbind:function(a){if(!this.hasElement(a))return;this.bindings.hasOwnProperty(a)&&(this.bindings[a].unbind(),delete this.bindings[a])},goOnline:function(){for(var a in this.views)this.views[a].goOnline()},goOffline:function(){for(var a in this.views)this.views[a].goOffline()},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},destroy:function(){for(var a in this.views)this.views[a].destroy(),delete this.views[a];for(var b in this.forms)this.forms[b].destroy(),delete this.forms[b];for(var c in this.elements)delete this.elements[c];delete this.target,delete this._parent}}).include(Events),b.views={view:b},b.prototype.typeList="",b.extend=function(a){var c=Class.extend.call(this,a),d=a.getType(),e=["getType"];for(var f=0,g=e.length;f<g;f++){if(!a.hasOwnProperty(e[f]))throw"Class missing '"+e[f]+"()' implementation";c[e[f]]=a[e[f]]}return c.prototype.typeList+=(c.prototype.typeList===""?"":" ")+d,c.extend=b.extend,b.views[d]=c},b.get=function(a){if(a==="view")return this;if(!this.views.hasOwnProperty(a))throw"View '"+a+'" not found';return this.views[a]},a.ViewController=b}(Orange),function(a){var b,c=a.Cache,d=a.Loader,e=a.Service,f=a.Storage,g=a.View,h=a.ViewController;b=Class.extend({initialize:function(a){if(!a.hasOwnProperty("name"))throw"Invalid application";this.name=a.name,this.required=a.hasOwnProperty("required")?a.required:[],this.loaded=!1,this.online=!1,this.env="PROD";for(var b=0,c=this.required.length;b<c;b++)d.loadModule(this.required[b])},loadServices:function(){for(var a in this.serviceConfig){var b=e.get(a),c=this.serviceConfig[a],d=new b(c.paths[this.env],c.auth);this.services[a]=d}},authenticate:function(a,b,c){if(this.services.hasOwnProperty(this.authService))throw"Cannot load authentication service";var d=this.services[this.authService];d.authenticate(a,b,c)},setEnvironment:function(a){this.env=a},setLogging:function(a){this.levels=a},getService:function(a){return this.services[a]},registerService:function(a,b,c){this.serviceConfig[a]={auth:b||null,paths:c||{}}},setAuthentication:function(a){this.authService=a},registerViews:function(a){g.load(a)},onHashChange:function(a){var b=location.hash.replace("#").split("/");this.root.setRoute(b,a)},onReady:function(){this.rootEl=$("[data-root]");var a=h.get(this.rootEl.attr("data-control"));this.root=new a(null,this.rootEl,this),this.root.load().show(),this.online?this.root.goOnline():this.root.goOffline(),this.onHashChange()},onOnline:function(){this.online=!0;for(var a in this.services)this.services[a].goOnline();this.storage.goOnline(),this.root.goOnline()},onOffline:function(){this.online=!1;for(var a in this.services)this.services[a].goOffline();f.goOffline(),this.root.goOffline()},onAuthSuccess:function(){window.onload=proxy(this.onReady,this)},onAuthFailure:function(){},launch:function(){if(this.loaded)return;!this.levels||!this.levels.hasOwnProperty(this.env)?Log.setLevel("DEBUG"):Log.setLevel(this.levels[this.env]),c.init(function(a){this.loadServices(),a?this.goOnline():this.goOffline(),c.on("online",function(a){a.data?this.goOnline():this.goOffline()},this),this.authenticate(this.onAuthSuccess,this.onAuthFailure,this)},this)}}),a.Application=b}(Orange);